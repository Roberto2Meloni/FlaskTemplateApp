{% extends "layouts/web_app_layouts/Einkaufsliste_web_app_base.html" %} {% block
content %}

<div class="container-fluid">
  <div class="einkaufsliste-container">
    <!-- Flash Messages -->
    <div class="flash-container">
      {% include "layouts/websites/flash_message.html" %}
    </div>

    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">
        <i class="bi bi-cart3" style="margin-right: 0.5rem; color: #28a745"></i>
        Einkaufsliste
      </h1>
      <div class="header-info">
        <small class="text-muted">
          <i class="bi bi-calendar-date"></i>
          {{ moment().format('DD. MMMM YYYY') if moment else today.strftime('%d.
          %B %Y') }}
        </small>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="button-container">
      <a
        href="{{ url_for('Einkaufsliste.newlist') }}"
        class="btn-custom btn-success-custom"
      >
        <i class="bi bi-plus-circle"></i>
        Neue Liste erstellen
      </a>
      <a
        href="{{ url_for('Einkaufsliste.Einkaufsliste_index') }}"
        class="btn-custom btn-light-custom"
      >
        <i class="bi bi-arrow-clockwise"></i>
        Aktualisieren
      </a>
      <a
        href="{{ url_for('Einkaufsliste.group') }}"
        class="btn-custom btn-light-custom"
      >
        <i class="bi bi-people"></i>
        Gruppen verwalten
      </a>
    </div>

    <!-- Table Container -->
    <div class="table-container">
      {% if lists %}
      <table class="table-custom">
        <thead>
          <tr>
            <th style="text-align: center; width: 5%">
              <i class="bi bi-star" title="Heute aktiv"></i>
            </th>
            <th style="text-align: center; width: 15%">
              <i class="bi bi-calendar-event"></i>
              Start Tag
            </th>
            <th class="tabel_end_day" style="text-align: center; width: 15%">
              <i class="bi bi-calendar-x"></i>
              End Tag
            </th>
            <th style="width: 25%">
              <i class="bi bi-people"></i>
              Gruppe
            </th>
            <th style="width: 25%">
              <i class="bi bi-person"></i>
              Ersteller
            </th>
            <th style="width: 15%; text-align: center">
              <i class="bi bi-gear"></i>
              Aktionen
            </th>
          </tr>
        </thead>
        <tbody>
          {% for list, group, user in lists %} {% set today_datetime =
          datetime.combine(today, datetime.min.time()) %}
          <tr
            class="clickable-row"
            onclick="window.location='{{ url_for('Einkaufsliste.ship_list', list_id=list.list_id) }}';"
          >
            <!-- Today Indicator -->
            <td style="text-align: center">
              {% if today_datetime >= list.first_day and today_datetime <=
              list.last_day %}
              <span class="today-star">&#9733;</span>
              {% else %}
              <span style="color: #dee2e6">&#9733;</span>
              {% endif %}
            </td>

            <!-- Start Date -->
            <td style="text-align: center">
              <div style="font-weight: 600; color: #28a745">
                {{ list.first_day.strftime('%d. %b') }}
              </div>
              <small class="text-muted"
                >{{ list.first_day.strftime('%Y') }}</small
              >
            </td>

            <!-- End Date -->
            <td class="tabel_end_day" style="text-align: center">
              <div style="font-weight: 600; color: #dc3545">
                {{ list.last_day.strftime('%d. %b') }}
              </div>
              <small class="text-muted"
                >{{ list.last_day.strftime('%Y') }}</small
              >
            </td>

            <!-- Group -->
            <td>
              <div style="display: flex; align-items: center; gap: 0.5rem">
                <div
                  style="
                    width: 10px;
                    height: 10px;
                    background: #28a745;
                    border-radius: 50%;
                  "
                ></div>
                <span style="font-weight: 500">{{ group.group_name }}</span>
              </div>
            </td>

            <!-- Creator -->
            <td>
              <div style="display: flex; align-items: center; gap: 0.5rem">
                <div
                  style="
                    width: 32px;
                    height: 32px;
                    background: linear-gradient(135deg, #007bff, #6610f2);
                    border-radius: 50%;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: bold;
                    font-size: 0.8rem;
                  "
                >
                  {{ user.username[0].upper() if user.username else 'U' }}
                </div>
                <span>{{ user.username }}</span>
              </div>
            </td>

            <!-- Actions -->
            <td style="text-align: center">
              <div
                style="
                  display: flex;
                  gap: 0.5rem;
                  justify-content: center;
                  align-items: center;
                "
              >
                <!-- View Button -->
                <a
                  href="{{ url_for('Einkaufsliste.ship_list', list_id=list.list_id) }}"
                  class="btn btn-sm btn-outline-primary"
                  onclick="event.stopPropagation();"
                  title="Liste anzeigen"
                >
                  <i class="bi bi-eye"></i>
                </a>

                <!-- Delete Button -->
                <a
                  href="{{ url_for('Einkaufsliste.delete_list', list_id=list.list_id) }}"
                  class="delete-icon"
                  onclick="event.stopPropagation(); return confirm('Möchten Sie diese Einkaufsliste wirklich löschen?\n\nListe: ' + '{{ list.first_day.strftime('%d.%m.%Y') }} - {{ list.last_day.strftime('%d.%m.%Y') }}' + '\nGruppe: {{ group.group_name }}');"
                  title="Liste löschen"
                >
                  <i class="bi bi-trash3-fill"></i>
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <!-- Empty State -->
      <div style="text-align: center; padding: 4rem 2rem; color: #6c757d">
        <i
          class="bi bi-cart-x"
          style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5"
        ></i>
        <h3 style="margin-bottom: 1rem; color: #495057">
          Keine Einkaufslisten vorhanden
        </h3>
        <p style="margin-bottom: 2rem; font-size: 1.1rem">
          Erstellen Sie Ihre erste Einkaufsliste, um loszulegen!
        </p>
        <a
          href="{{ url_for('Einkaufsliste.newlist') }}"
          class="btn-custom btn-success-custom"
        >
          <i class="bi bi-plus-circle"></i>
          Erste Liste erstellen
        </a>
      </div>
      {% endif %}
    </div>

    <!-- Footer Info -->
    <div
      style="
        margin-top: 2rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(0, 0, 0, 0.1);
        text-align: center;
        color: #6c757d;
        font-size: 0.9rem;
      "
    >
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          flex-wrap: wrap;
          gap: 1rem;
        "
      >
        <div>
          <i class="bi bi-info-circle"></i>
          {% if lists %} {{ lists|length }} Liste{{ 's' if lists|length != 1
          else '' }} insgesamt {% else %} Keine Listen verfügbar {% endif %}
        </div>
        <div>
          <small>
            <i class="bi bi-clock"></i>
            Letzte Aktualisierung: {{ moment().format('HH:mm') if moment else
            'jetzt' }}
          </small>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

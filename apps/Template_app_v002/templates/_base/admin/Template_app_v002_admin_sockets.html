<div class="sockets-container">
  <!-- Header -->
  <div class="sockets-header">
    <div class="header-left">
      <h4><i class="bi bi-plug-fill"></i> Socket Verbindungen</h4>
      <p class="sockets-subtitle">
        Aktive WebSocket-Verbindungen für {{ app_config.app_name }}
      </p>
    </div>
    <div class="header-right">
      <button
        id="refreshBtn"
        class="btn btn-secondary"
        onclick="refreshSocketList()"
      >
        <i class="bi bi-arrow-clockwise"></i> Aktualisieren
      </button>

      <button
        id="disconnectAllBtn"
        class="btn btn-danger"
        onclick="disconnectAllSockets()"
      >
        <i class="bi bi-x-circle"></i> Alle trennen
      </button>
    </div>
  </div>

  <!-- Socket Status & Test Section -->
  <div class="socket-test-section">
    <div class="test-card">
      <div class="test-card-header">
        <h5><i class="bi bi-activity"></i> Socket Status & Tests</h5>
      </div>
      <div class="test-card-body">
        <!-- Connection Status -->
        <div class="connection-status">
          <div class="status-indicator">
            <div id="socketStatus" class="status-badge offline">
              <span class="status-dot"></span>
              <span class="status-text">Getrennt</span>
            </div>
            <div id="socketId" class="socket-info">Socket ID: -</div>
          </div>
          <div id="lastPing" class="last-activity">Letzter Ping: -</div>
        </div>

        <!-- Test Buttons -->
        <div class="test-buttons">
          <button
            id="connectBtn"
            class="btn btn-success"
            onclick="testSocketConnect()"
          >
            <i class="bi bi-plug"></i> Verbinden
          </button>
          <button
            id="pingBtn"
            class="btn btn-primary"
            onclick="testSocketPing()"
            disabled
          >
            <i class="bi bi-lightning"></i> Ping senden
          </button>
          <button
            id="disconnectBtn"
            class="btn btn-warning"
            onclick="testSocketDisconnect()"
            disabled
          >
            <i class="bi bi-plug-fill"></i> Trennen
          </button>
        </div>

        <!-- Test Log -->
        <div class="test-log-section">
          <div class="test-log-header">
            <span>Event Log</span>
            <button class="btn-small" onclick="clearTestLog()">
              <i class="bi bi-trash"></i> Löschen
            </button>
          </div>
          <div id="testLog" class="test-log">
            <div class="log-entry log-info">
              <span class="log-time">--:--:--</span>
              <span class="log-message">Bereit für Tests...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics -->
  <div class="sockets-stats">
    <div class="stat-card">
      <div class="stat-icon">
        <i class="bi bi-link-45deg"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value" id="totalConnections">
          {{ active_sockets|length }}
        </div>
        <div class="stat-label">Aktive Verbindungen</div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-icon">
        <i class="bi bi-people"></i>
      </div>
      <div class="stat-content">
        <div class="stat-value" id="onlineUsers">
          {{ online_users_count|default(0) }}
        </div>
        <div class="stat-label">Online Benutzer</div>
      </div>
    </div>
  </div>

  <!-- Sockets Table -->
  <div class="sockets-content">
    {% if active_sockets %}
    <div class="sockets-table-wrapper">
      <table class="sockets-table" id="socketsTable">
        <thead>
          <tr>
            <th><i class="bi bi-person"></i> Benutzer</th>
            <th><i class="bi bi-fingerprint"></i> Socket ID</th>
            <th><i class="bi bi-clock"></i> Verbunden seit</th>
            <th><i class="bi bi-gear"></i> Aktionen</th>
          </tr>
        </thead>
        <tbody id="socketsTableBody">
          {% for sid, socket in active_sockets.items() %}
          <tr data-sid="{{ sid }}">
            <td>
              <div class="user-info">
                <i class="bi bi-person-circle user-icon"></i>
                <span class="username">{{ socket.username }}</span>
                {% if socket.user_id %}
                <span class="user-badge authenticated">Auth</span>
                {% else %}
                <span class="user-badge guest">Gast</span>
                {% endif %}
              </div>
            </td>
            <td>
              <code class="socket-id">{{ sid[:16] }}...</code>
            </td>
            <td>
              <span class="timestamp">{{ socket.connected_at }}</span>
            </td>
            <td>
              <button
                class="btn-icon btn-disconnect"
                onclick="disconnectSocket('{{ sid }}')"
                title="Verbindung trennen"
              >
                <i class="bi bi-x-circle"></i>
              </button>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% else %}
    <div class="empty-state">
      <i class="bi bi-plug"></i>
      <h5>Keine aktiven Verbindungen</h5>
      <p>Aktuell sind keine Socket-Verbindungen für diese App aktiv.</p>
    </div>
    {% endif %}
  </div>

  <!-- Status Messages -->
  <div id="statusMessage" class="status-message" style="display: none"></div>
</div>
